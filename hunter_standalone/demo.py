import asyncio
import json
from database import HunterDatabase
from hunter import LeadHunter

async def main():
    # 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î
    db = HunterDatabase("hunter_demo.db")
    await db.connect()

    hunter = LeadHunter(db)

    # 2. –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (–∏–º–∏—Ç–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ —á–∞—Ç–æ–≤)
    mock_messages = [
        {
            "url": "https://t.me/chat1/123",
            "text": "–†–µ–±—è—Ç–∞, –ø–æ—Å–æ–≤–µ—Ç—É–π—Ç–µ —Ö–æ—Ä–æ—à–µ–≥–æ –¥–∏–∑–∞–π–Ω–µ—Ä–∞ –≤ –ú–æ—Å–∫–≤–µ! –ö—É–ø–∏–ª–∏ –∫–≤–∞—Ä—Ç–∏—Ä—É –≤ –ñ–ö –°–∏–º–≤–æ–ª, –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ø—Ä–æ–µ–∫—Ç –ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ –∏ –≤—Å–µ —Å–æ–≥–ª–∞—Å–æ–≤–∞—Ç—å. –°–∏–ª —É–∂–µ –Ω–µ—Ç —Å–ø–æ—Ä–∏—Ç—å —Å –º—É–∂–µ–º –ø—Ä–æ —Å—Ç–µ–Ω—ã."
        },
        {
            "url": "https://t.me/chat2/456",
            "text": "–£—Å–ª—É–≥–∏ –¥–∏–∑–∞–π–Ω–µ—Ä–∞ –∏–Ω—Ç–µ—Ä—å–µ—Ä–æ–≤. –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ, –±—ã—Å—Ç—Ä–æ, –Ω–µ–¥–æ—Ä–æ–≥–æ. –ü–∏—Å–∞—Ç—å –≤ –õ–°."
        },
        {
            "url": "https://t.me/chat3/789",
            "text": "–ü–æ–¥—Å–∫–∞–∂–∏—Ç–µ, –∞ –º–æ–∂–Ω–æ –ª–∏ —Å–Ω–æ—Å–∏—Ç—å —Å—Ç–µ–Ω—É –º–µ–∂–¥—É –∫—É—Ö–Ω–µ–π –∏ –≥–æ—Å—Ç–∏–Ω–æ–π –≤ –ø–∞–Ω–µ–ª—å–∫–µ? –ú–æ—Å–∫–≤–∞, —Å–µ—Ä–∏—è –ü-44—Ç."
        }
    ]

    print("üîé –ó–∞–ø—É—Å–∫ Lead Hunter (–®–ø–∏–æ–Ω)...")
    leads = await hunter.hunt(mock_messages)

    print(f"\n‚úÖ –ù–∞–π–¥–µ–Ω–æ –Ω–æ–≤—ã—Ö –ª–∏–¥–æ–≤: {len(leads)}")
    for lead in leads:
        print(f"\n--- –ö–ê–†–¢–û–ß–ö–ê –õ–ò–î–ê ---")
        print(f"üîó –°—Å—ã–ª–∫–∞: {lead['url']}")
        print(f"üéØ –ù–∞–º–µ—Ä–µ–Ω–∏–µ: {lead['intent']}")
        print(f"üî• –ì–æ—Ä—è—á–µ—Å—Ç—å: {lead['hotness']}/5")
        print(f"üìç –ì–µ–æ: {lead['geo']}")
        print(f"ü§ï –ë–æ–ª—å –∫–ª–∏–µ–Ω—Ç–∞: {lead['context_summary']}")

    # 3. –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
    await db.export_to_json("leads_demo.json")
    print("\nüìÅ –î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ leads_demo.json")

if __name__ == "__main__":
    asyncio.run(main())
