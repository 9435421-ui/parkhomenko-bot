"""
Migration: Add holidays table for automatic holiday greetings
Date: 2026-01-21
Author: VS Code AI
"""

import sqlite3
import os

def migrate():
    """Apply the migration"""
    db_path = os.getenv("DATABASE_URL", "sqlite:///parkhomenko_bot.db").replace("sqlite:///", "")

    conn = sqlite3.connect(db_path)
    cursor = conn.cursor()

    # Create holidays table
    cursor.execute("""
        CREATE TABLE IF NOT EXISTS holidays (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            date TEXT NOT NULL,  -- Format: YYYY-MM-DD
            name TEXT NOT NULL,
            message_template TEXT NOT NULL,
            created_at DATETIME DEFAULT CURRENT_TIMESTAMP
        )
    """)

    # Create index for date lookups
    cursor.execute("""
        CREATE INDEX IF NOT EXISTS idx_holidays_date
        ON holidays(date)
    """)

    # Insert some default holidays (Russian holidays)
    default_holidays = [
        ('2026-01-01', '–ù–æ–≤—ã–π –≥–æ–¥', 'üéÑ –° –ù–æ–≤—ã–º –≥–æ–¥–æ–º! –ü—É—Å—Ç—å —ç—Ç–æ—Ç –≥–æ–¥ –ø—Ä–∏–Ω–µ—Å–µ—Ç –≤–∞–º –Ω–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏, —É—Å–ø–µ—Ö –≤ –¥–µ–ª–∞—Ö –∏ —Ç–µ–ø–ª–æ –≤ –¥–æ–º–µ. –ñ–µ–ª–∞–µ–º –∫—Ä–µ–ø–∫–æ–≥–æ –∑–¥–æ—Ä–æ–≤—å—è –∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –∂–µ–ª–∞–Ω–∏–π!'),
        ('2026-01-07', '–†–æ–∂–¥–µ—Å—Ç–≤–æ –•—Ä–∏—Å—Ç–æ–≤–æ', '‚úùÔ∏è –° –†–æ–∂–¥–µ—Å—Ç–≤–æ–º –•—Ä–∏—Å—Ç–æ–≤—ã–º! –ü—É—Å—Ç—å —ç—Ç–æ—Ç –ø—Ä–∞–∑–¥–Ω–∏–∫ –Ω–∞–ø–æ–ª–Ω–∏—Ç –≤–∞—à—É –∂–∏–∑–Ω—å —Å–≤–µ—Ç–æ–º, –º–∏—Ä–æ–º –∏ –ª—é–±–æ–≤—å—é. –ñ–µ–ª–∞–µ–º —Å—á–∞—Å—Ç—å—è –∏ –±–ª–∞–≥–æ–ø–æ–ª—É—á–∏—è –≤—Å–µ–π —Å–µ–º—å–µ!'),
        ('2026-02-23', '–î–µ–Ω—å –∑–∞—â–∏—Ç–Ω–∏–∫–∞ –û—Ç–µ—á–µ—Å—Ç–≤–∞', 'üéñÔ∏è –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º –º—É–∂—á–∏–Ω —Å –î–Ω–µ–º –∑–∞—â–∏—Ç–Ω–∏–∫–∞ –û—Ç–µ—á–µ—Å—Ç–≤–∞! –ñ–µ–ª–∞–µ–º –º—É–∂–µ—Å—Ç–≤–∞, —Å–∏–ª—ã –¥—É—Ö–∞ –∏ –Ω–∞–¥–µ–∂–Ω–æ–≥–æ —Ç—ã–ª–∞ –≤ –ª–∏—Ü–µ –±–ª–∏–∑–∫–∏—Ö. –ü—É—Å—Ç—å –≤ –≤–∞—à–µ–º –¥–æ–º–µ –≤—Å–µ–≥–¥–∞ —Ü–∞—Ä—è—Ç –º–∏—Ä –∏ –ª—é–±–æ–≤—å!'),
        ('2026-03-08', '–ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–π –∂–µ–Ω—Å–∫–∏–π –¥–µ–Ω—å', 'üíê –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º –ø—Ä–µ–∫—Ä–∞—Å–Ω—ã—Ö –∂–µ–Ω—â–∏–Ω —Å 8 –ú–∞—Ä—Ç–∞! –ñ–µ–ª–∞–µ–º –∫—Ä–∞—Å–æ—Ç—ã, –ª—é–±–≤–∏, –≤–Ω–∏–º–∞–Ω–∏—è –∏ –∑–∞–±–æ—Ç—ã. –ü—É—Å—Ç—å –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –±—É–¥–µ—Ç –Ω–∞–ø–æ–ª–Ω–µ–Ω —Å—á–∞—Å—Ç—å–µ–º –∏ —É–ª—ã–±–∫–∞–º–∏!'),
        ('2026-05-01', '–ü—Ä–∞–∑–¥–Ω–∏–∫ –í–µ—Å–Ω—ã –∏ –¢—Ä—É–¥–∞', 'üå∏ –° –ü–µ—Ä–≤–æ–º–∞–µ–º! –ñ–µ–ª–∞–µ–º —Ç—Ä—É–¥–æ–≤—ã—Ö —É—Å–ø–µ—Ö–æ–≤, —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –∏ –∑–∞—Å–ª—É–∂–µ–Ω–Ω–æ–≥–æ –æ—Ç–¥—ã—Ö–∞. –ü—É—Å—Ç—å –≤–µ—Å–Ω–∞ –ø—Ä–∏–Ω–µ—Å–µ—Ç –Ω–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∏ —Ä–∞–¥–æ—Å—Ç–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è!'),
        ('2026-05-09', '–î–µ–Ω—å –ü–æ–±–µ–¥—ã', 'üéñÔ∏è –° –î–Ω–µ–º –í–µ–ª–∏–∫–æ–π –ü–æ–±–µ–¥—ã! –í–µ—á–Ω–∞—è –ø–∞–º—è—Ç—å –≥–µ—Ä–æ—è–º! –ñ–µ–ª–∞–µ–º –º–∏—Ä–∞, —Å–æ–≥–ª–∞—Å–∏—è –∏ –ø—Ä–æ—Ü–≤–µ—Ç–∞–Ω–∏—è –Ω–∞—à–µ–π —Å—Ç—Ä–∞–Ω–µ. –ü—É—Å—Ç—å —ç—Ç–æ—Ç –ø—Ä–∞–∑–¥–Ω–∏–∫ –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –Ω–∞—Å –≤—Å–µ—Ö!'),
        ('2026-06-12', '–î–µ–Ω—å –†–æ—Å—Å–∏–∏', 'üèõÔ∏è –° –î–Ω–µ–º –†–æ—Å—Å–∏–∏! –ñ–µ–ª–∞–µ–º –Ω–∞—à–µ–π —Å—Ç—Ä–∞–Ω–µ –ø—Ä–æ—Ü–≤–µ—Ç–∞–Ω–∏—è, –∞ –≥—Ä–∞–∂–¥–∞–Ω–∞–º ‚Äî –µ–¥–∏–Ω—Å—Ç–≤–∞, –ø–∞—Ç—Ä–∏–æ—Ç–∏–∑–º–∞ –∏ –ª—é–±–≤–∏ –∫ –û—Ç–µ—á–µ—Å—Ç–≤—É. –ü—É—Å—Ç—å –†–æ—Å—Å–∏—è –±—É–¥–µ—Ç —Å–∏–ª—å–Ω–æ–π –∏ —Å—á–∞—Å—Ç–ª–∏–≤–æ–π!'),
        ('2026-11-04', '–î–µ–Ω—å –Ω–∞—Ä–æ–¥–Ω–æ–≥–æ –µ–¥–∏–Ω—Å—Ç–≤–∞', 'ü§ù –° –î–Ω–µ–º –Ω–∞—Ä–æ–¥–Ω–æ–≥–æ –µ–¥–∏–Ω—Å—Ç–≤–∞! –ñ–µ–ª–∞–µ–º —Å–ø–ª–æ—á–µ–Ω–Ω–æ—Å—Ç–∏, –≤–∑–∞–∏–º–æ–ø–æ–Ω–∏–º–∞–Ω–∏—è –∏ —Å–æ–≥–ª–∞—Å–∏—è –≤ –æ–±—â–µ—Å—Ç–≤–µ. –ü—É—Å—Ç—å —ç—Ç–æ—Ç –ø—Ä–∞–∑–¥–Ω–∏–∫ –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –Ω–∞—Å –≤—Å–µ—Ö!'),
        ('2026-12-31', '–ü–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–Ω—å –≥–æ–¥–∞', 'üéä –ü–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–Ω—å —É—Ö–æ–¥—è—â–µ–≥–æ –≥–æ–¥–∞! –ü—É—Å—Ç—å –æ–Ω –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è –∫—Ä–∞—Å–∏–≤–æ, –∞ –Ω–æ–≤—ã–π –ø—Ä–∏–Ω–µ—Å–µ—Ç —Ç–æ–ª—å–∫–æ —Ä–∞–¥–æ—Å—Ç—å, —É—Å–ø–µ—Ö –∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –∂–µ–ª–∞–Ω–∏–π!'),
    ]

    cursor.executemany("""
        INSERT OR IGNORE INTO holidays (date, name, message_template)
        VALUES (?, ?, ?)
    """, default_holidays)

    conn.commit()
    conn.close()

    print("‚úÖ Migration 20260121_add_holidays_table applied successfully")
    print(f"üìÖ Added {len(default_holidays)} default holidays")

if __name__ == "__main__":
    migrate()
