#!/bin/bash
# upgrade_quiz_run.sh ‚Äî –ö–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–≤–∏–∑–∞ –¢–û–†–ò–û–ù

set -e # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏ –æ—à–∏–±–∫–µ

echo "üöÄ –ó–∞–ø—É—Å–∫ —Ü–∏–∫–ª–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–≤–∏–∑–∞..."

# 1. –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
timestamp=$(date +"%Y%m%d_%H%M%S")
mkdir -p ../backups
cp ../handlers/quiz.py ../backups/quiz_backup_$timestamp.py
echo "‚úÖ –ë—ç–∫–∞–ø —Å–æ–∑–¥–∞–Ω: backups/quiz_backup_$timestamp.py"

# 2. –ó–∞–ø—É—Å–∫ –ø–∞—Ç—á–µ—Ä–∞
bash upgrade_quiz_automation.sh
echo "‚úÖ –ü–∞—Ç—á–µ—Ä upgrade_quiz_automation.sh –æ—Ç—Ä–∞–±–æ—Ç–∞–ª"

# 3. –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
echo "üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤..."
(cd .. && source venv/bin/activate && python3 handlers/quiz_test.py)
echo "‚úÖ –¢–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã"

# 4. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞
echo "‚ôªÔ∏è –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞..."
(cd .. && bash run_bot.sh &)
sleep 2

# 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
echo "üìù –ü–æ—Å–ª–µ–¥–Ω–∏–µ 10 —Å—Ç—Ä–æ–∫ –ª–æ–≥–∞:"
tail -n 10 ../bot.log

echo "üéâ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!"
