 –µ–±–µ –µ—â–µ import requests
import os
from datetime import datetime, timedelta
import json

class ContentAgent:
    def __init__(self):
        self.folder_id = os.getenv("FOLDER_ID")
        self.api_key = os.getenv("YANDEX_API_KEY")
        self.endpoint = "https://llm.api.cloud.yandex.net/foundationModels/v1/completion"
        self.brief_content = self._load_brief()

        # –®–∞–±–ª–æ–Ω—ã –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–π —Å –¥–Ω–µ–º —Ä–æ–∂–¥–µ–Ω–∏—è (–±–µ–∑ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è —É—Å–ª—É–≥/–ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–æ–∫)
        self.birthday_templates = [
            "–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º –≤–∞—Å —Å –¥–Ω–µ–º —Ä–æ–∂–¥–µ–Ω–∏—è! –ü—É—Å—Ç—å —ç—Ç–æ—Ç –¥–µ–Ω—å –±—É–¥–µ—Ç –Ω–∞–ø–æ–ª–Ω–µ–Ω —Ä–∞–¥–æ—Å—Ç—å—é, —Ç–µ–ø–ª–æ–º –±–ª–∏–∑–∫–∏—Ö –∏ –ø—Ä–∏—è—Ç–Ω—ã–º–∏ —Å—é—Ä–ø—Ä–∏–∑–∞–º–∏. –ñ–µ–ª–∞–µ–º –∫—Ä–µ–ø–∫–æ–≥–æ –∑–¥–æ—Ä–æ–≤—å—è, –¥—É—à–µ–≤–Ω–æ–≥–æ —Ä–∞–≤–Ω–æ–≤–µ—Å–∏—è –∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è —Å–∞–º—ã—Ö –∑–∞–≤–µ—Ç–Ω—ã—Ö –∂–µ–ª–∞–Ω–∏–π.",
            "–° –¥–Ω–µ–º —Ä–æ–∂–¥–µ–Ω–∏—è! –ü—É—Å—Ç—å —ç—Ç–æ—Ç –æ—Å–æ–±–µ–Ω–Ω—ã–π –¥–µ–Ω—å –ø—Ä–∏–Ω–µ—Å–µ—Ç –≤–∞–º –º–æ—Ä–µ —É–ª—ã–±–æ–∫, —Ç–µ–ø–ª–∞ –æ—Ç —Ä–æ–¥–Ω—ã—Ö –∏ –¥—Ä—É–∑–µ–π, –∞ —Ç–∞–∫–∂–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –º–µ—á—Ç–∞–Ω–∏–π. –ñ–µ–ª–∞–µ–º –∑–¥–æ—Ä–æ–≤—å—è, —Å—á–∞—Å—Ç—å—è –∏ –±–ª–∞–≥–æ–ø–æ–ª—É—á–∏—è –Ω–∞ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å.",
            "–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º —Å –¥–Ω–µ–º —Ä–æ–∂–¥–µ–Ω–∏—è! –ü—É—Å—Ç—å —ç—Ç–æ—Ç –¥–µ–Ω—å –±—É–¥–µ—Ç —è—Ä–∫–∏–º –∏ –Ω–µ–∑–∞–±—ã–≤–∞–µ–º—ã–º, –Ω–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–º –ª—é–±–æ–≤—å—é –±–ª–∏–∑–∫–∏—Ö –∏ –ø—Ä–∏—è—Ç–Ω—ã–º–∏ –º–æ–º–µ–Ω—Ç–∞–º–∏. –ñ–µ–ª–∞–µ–º –∫—Ä–µ–ø–∫–æ–≥–æ –∑–¥–æ—Ä–æ–≤—å—è, —Å–µ–º–µ–π–Ω–æ–≥–æ —Ç–µ–ø–ª–∞ –∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –≤—Å–µ—Ö –ø–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö —Ü–µ–ª–µ–π.",
            "–° –¥–Ω–µ–º —Ä–æ–∂–¥–µ–Ω–∏—è! –ü—É—Å—Ç—å —ç—Ç–æ—Ç –ø—Ä–∞–∑–¥–Ω–∏–∫ –ø—Ä–∏–Ω–µ—Å–µ—Ç –≤–∞–º –∑–∞—Ä—è–¥ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã—Ö —ç–º–æ—Ü–∏–π, —Ç–µ–ø–ª—ã–µ –æ–±—ä—è—Ç–∏—è —Ä–æ–¥–Ω—ã—Ö –∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –∂–µ–ª–∞–Ω–∏–π. –ñ–µ–ª–∞–µ–º –∑–¥–æ—Ä–æ–≤—å—è, —Å—á–∞—Å—Ç—å—è –∏ –±–ª–∞–≥–æ–ø–æ–ª—É—á–∏—è –≤ –≤–∞—à–µ–π –∂–∏–∑–Ω–∏.",
            "–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º —Å –¥–Ω–µ–º —Ä–æ–∂–¥–µ–Ω–∏—è! –ü—É—Å—Ç—å —ç—Ç–æ—Ç –¥–µ–Ω—å –±—É–¥–µ—Ç –æ—Å–æ–±–µ–Ω–Ω—ã–º, –Ω–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–º —Ä–∞–¥–æ—Å—Ç—å—é, —Ç–µ–ø–ª–æ–º –∏ –∑–∞–±–æ—Ç–æ–π –±–ª–∏–∑–∫–∏—Ö. –ñ–µ–ª–∞–µ–º –∫—Ä–µ–ø–∫–æ–≥–æ –∑–¥–æ—Ä–æ–≤—å—è, –¥—É—à–µ–≤–Ω–æ–≥–æ –∫–æ–º—Ñ–æ—Ä—Ç–∞ –∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –≤—Å–µ—Ö –º–µ—á—Ç–∞–Ω–∏–π.",
            "–° –¥–Ω–µ–º —Ä–æ–∂–¥–µ–Ω–∏—è! –ü—É—Å—Ç—å —ç—Ç–æ—Ç –ø—Ä–∞–∑–¥–Ω–∏–∫ —Å—Ç–∞–Ω–µ—Ç –Ω–∞—á–∞–ª–æ–º –Ω–æ–≤—ã—Ö —Ä–∞–¥–æ—Å—Ç–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π –≤ –≤–∞—à–µ–π –∂–∏–∑–Ω–∏. –ñ–µ–ª–∞–µ–º –∑–¥–æ—Ä–æ–≤—å—è, —Å—á–∞—Å—Ç—å—è, —Å–µ–º–µ–π–Ω–æ–≥–æ —Ç–µ–ø–ª–∞ –∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è —Å–∞–º—ã—Ö —Å–æ–∫—Ä–æ–≤–µ–Ω–Ω—ã—Ö –∂–µ–ª–∞–Ω–∏–π.",
            "–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º —Å –¥–Ω–µ–º —Ä–æ–∂–¥–µ–Ω–∏—è! –ü—É—Å—Ç—å —ç—Ç–æ—Ç –¥–µ–Ω—å –±—É–¥–µ—Ç —è—Ä–∫–∏–º –∏ –Ω–µ–∑–∞–±—ã–≤–∞–µ–º—ã–º, –∞ –∫–∞–∂–¥—ã–π –Ω–æ–≤—ã–π –¥–µ–Ω—å –ø—Ä–∏–Ω–æ—Å–∏—Ç –Ω–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∏ —Ä–∞–¥–æ—Å—Ç–∏. –ñ–µ–ª–∞–µ–º –∫—Ä–µ–ø–∫–æ–≥–æ –∑–¥–æ—Ä–æ–≤—å—è –∏ –±–ª–∞–≥–æ–ø–æ–ª—É—á–∏—è.",
            "–° –¥–Ω–µ–º —Ä–æ–∂–¥–µ–Ω–∏—è! –ñ–µ–ª–∞–µ–º –≤–∞–º —Ç–µ–ø–ª–∞ –æ—Ç –±–ª–∏–∑–∫–∏—Ö, —Ä–∞–¥–æ—Å—Ç–∏ –æ—Ç –º–∞–ª–µ–Ω—å–∫–∏—Ö –ø–æ–±–µ–¥ –∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –º–µ—á—Ç–∞–Ω–∏–π. –ü—É—Å—Ç—å —ç—Ç–æ—Ç –¥–µ–Ω—å —Å—Ç–∞–Ω–µ—Ç –æ–¥–Ω–∏–º –∏–∑ —Å–∞–º—ã—Ö —Å—á–∞—Å—Ç–ª–∏–≤—ã—Ö –≤ –≤–∞—à–µ–π –∂–∏–∑–Ω–∏."
        ]

    def generate_welcome_post(self, person_name: str | None = None):
        """
        –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ-–≤–∏–∑–∏—Ç–∫—É –¥–ª—è –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞.

        Args:
            person_name: –ò–º—è —á–µ–ª–æ–≤–µ–∫–∞ –∏–ª–∏ None

        Returns:
            dict: {'title': str, 'body': str, 'cta': str, 'type': '–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ'}
        """
        display_name = person_name if person_name else "–Ω–æ–≤—ã–π –ø–æ–¥–ø–∏—Å—á–∏–∫"

        prompt = f"""
–°–æ–∑–¥–∞–π –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è Telegram-–∫–∞–Ω–∞–ª–∞ –ø–æ –ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∞–º.

–ê–¥—Ä–µ—Å–∞—Ç: {display_name}

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- 80‚Äì120 —Å–ª–æ–≤
- –ö—Ä–∞—Ç–∫–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å –∫–∞–Ω–∞–ª –∏ –ø–æ–ª—å–∑—É: –ø–æ–º–æ—â—å —Å –≤–æ–ø—Ä–æ—Å–∞–º–∏ –ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏, —Ä–∏—Å–∫–∞–º–∏, —É–∑–∞–∫–æ–Ω–∏–≤–∞–Ω–∏–µ–º
- 1‚Äì2 –ø—Ä–æ—Å—Ç—ã—Ö –ø—Ä–∏–º–µ—Ä–∞ —Å–∏—Ç—É–∞—Ü–∏–π, –∫–æ–≥–¥–∞ –∫ –Ω–∞–º –º–æ–∂–Ω–æ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è (–ø–µ—Ä–µ–Ω–æ—Å —Å—Ç–µ–Ω, –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –∫—É—Ö–Ω–∏ –∏ –∫–æ–º–Ω–∞—Ç—ã, –ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∞ —Å –º–æ–∫—Ä—ã–º–∏ –∑–æ–Ω–∞–º–∏)
- –û–¥–∏–Ω –∞–∫–∫—É—Ä–∞—Ç–Ω—ã–π CTA –∫ –±–æ—Ç—É @–¢–ï–†–ò–û–ù_i_kompaniya_bot
- –°–ø–æ–∫–æ–π–Ω—ã–π, –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π —Ç–æ–Ω

–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞:
üëã {display_name}

[–¢–µ–∫—Å—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è 2‚Äì3 –∞–±–∑–∞—Ü–∞ —Å CTA –≤ –∫–æ–Ω—Ü–µ]
"""
        text = self._call_yandex_gpt(prompt, mode="default")  # –æ–±—ã—á–Ω—ã–π –ø—Ä–æ–¥–∞—é—â–∏–π —Ä–µ–∂–∏–º
        title, body, cta = self._parse_response(text)

return {
            'type': '–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ',
            'title': title,
            'body': body,
            'cta': cta
        }

    def generate_greeting_post(self, person_name, date, occasion='–¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è'):
        """
        –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ø–æ–∑–¥—Ä–∞–≤–∏—Ç–µ–ª—å–Ω—ã–π –ø–æ—Å—Ç

        Args:
            person_name: –ò–º—è —á–µ–ª–æ–≤–µ–∫–∞ (–º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º)
            date: –î–∞—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ DD.MM –∏–ª–∏ DD.MM.YYYY
            occasion: –ü–æ–≤–æ–¥ –¥–ª—è –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è ('–¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è', '–ù–æ–≤—ã–π –≥–æ–¥', etc.)

        Returns:
            dict: {'title': str, 'body': str, 'cta': str, 'type': '–ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ'}
        """
        display_name = person_name if person_name else "–Ω–∞—à –ø–æ–¥–ø–∏—Å—á–∏–∫"

        prompt = f"""
–°–æ–∑–¥–∞–π –∫–æ—Ä–æ—Ç–∫–æ–µ –∏—Å–∫—Ä–µ–Ω–Ω–µ–µ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è –ª–∏—á–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Telegram.

–ü–æ–≤–æ–¥: {occasion}
–ò–º—è: {display_name}
–î–∞—Ç–∞: {date}

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- –¢—ë–ø–ª–æ–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–µ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ (60‚Äì100 —Å–ª–æ–≤)
- –ü–æ–∂–µ–ª–∞–Ω–∏—è –∑–¥–æ—Ä–æ–≤—å—è, —Ä–∞–¥–æ—Å—Ç–∏, –¥—É—à–µ–≤–Ω–æ–≥–æ –∫–æ–º—Ñ–æ—Ä—Ç–∞, —É—é—Ç–∞ –¥–æ–º–∞
- –ü—Ä–æ—Å—Ç–æ–π –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π —è–∑—ã–∫, –±–µ–∑ –≤—ã—Å–æ–∫–æ–ø–∞—Ä–Ω–æ–≥–æ –∫–∞–Ω—Ü–µ–ª—è—Ä–∏—Ç–∞
- –°—Ç—Ä–æ–≥–æ –∑–∞–ø—Ä–µ—â–µ–Ω–æ —É–ø–æ–º–∏–Ω–∞—Ç—å —É—Å–ª—É–≥–∏, —Ä–µ–º–æ–Ω—Ç, –ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∫—É, –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏, –±–æ—Ç–æ–≤, –∫–æ–º–ø–∞–Ω–∏–∏, –∞–∫—Ü–∏–∏, —Å–∫–∏–¥–∫–∏ –∏ –ª—é–±—ã–µ –ø—Ä–æ–¥–∞–∂–∏.
- –ù–µ –¥–æ–±–∞–≤–ª—è–π CTA, —Å—Å—ã–ª–∫–∏, —Ö—ç—à—Ç–µ–≥–∏, GIF –∏ –ø—Ä–∏–∑—ã–≤—ã —á—Ç–æ-—Ç–æ –∑–∞–∫–∞–∑–∞—Ç—å –∏–ª–∏ —É–∑–Ω–∞—Ç—å.

–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞:
üéÇ {display_name}

[–ü–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ —Å –ø–æ–∂–µ–ª–∞–Ω–∏—è–º–∏]
"""

        text = self._call_yandex_gpt(prompt, mode="greeting")
        text = self._sanitize_greeting(text)

        # –î–ª—è –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è title –º–æ–∂–Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å, –≤—Å—ë –≤ body
        title = ""
        body = text.strip()
        cta = ""  # –Ω–∏–∫–∞–∫–∏—Ö CTA –≤ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–∏

        return {
            'type': '–ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ',
            'title': title,
            'body': body,
            'cta': cta
        }

    def build_image_prompt(self, post: dict) -> str | None:
        """
        –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫ –ø–æ—Å—Ç—É.
        –ü–æ–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–∏–ø–∞ '–∂–∏–≤–æ–π'.
        """
        post_type = post.get('type')

        if post_type != '–∂–∏–≤–æ–π':
            return None

        # –ë–∞–∑–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è ¬´–∂–∏–≤—ã—Ö¬ª –ø–æ—Å—Ç–æ–≤
        return (
            "—É—é—Ç–Ω–∞—è –≥–æ—Å—Ç–∏–Ω–∞—è –ø–æ—Å–ª–µ —Ä–µ–º–æ–Ω—Ç–∞, –º—è–≥–∫–∏–π —Å–≤–µ—Ç, —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—å–µ—Ä, "
            "–±–µ–∑ –ª—é–¥–µ–π, –±–µ–∑ —Ç–µ–∫—Å—Ç–∞, —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Å—Ç–æ—Ä–æ–Ω 16:9"
        )

    def _load_brief(self):
        """–ó–∞–≥—Ä—É–∂–∞–µ—Ç –±–∞–∑—É –∑–Ω–∞–Ω–∏–π"""
        try:
            with open("BRIEF_pereplanirovki.md", "r", encoding="utf-8") as f:
                return f.read()
        except FileNotFoundError:
            return "–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–±—â–∏–µ –∑–Ω–∞–Ω–∏—è –ø–æ –ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∞–º."

    def generate_posts(self, count=7, post_types=None, theme=None):
        """
        –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç N –ø–æ—Å—Ç–æ–≤
        post_types: {'—ç–∫—Å–ø–µ—Ä—Ç–∏–∑–∞': 5, '–∂–∏–≤–æ–π': 1, '–Ω–æ–≤–æ—Å—Ç—å': 1}
        theme: –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Ç–µ–º–∞ –Ω–µ–¥–µ–ª–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä: "–Ω–æ–≤—ã–π –≥–æ–¥ –∏ –∑–∏–º–Ω–∏–µ –ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏")
        """
        if post_types is None:
            post_types = {'—ç–∫—Å–ø–µ—Ä—Ç–∏–∑–∞': count - 1, '–∂–∏–≤–æ–π': 1}

        posts = []
        start_date = datetime.now() + timedelta(days=1)
        start_date = start_date.replace(hour=10, minute=0, second=0)

        for post_type, num in post_types.items():
            for i in range(num):
                prompt = self._build_prompt(post_type, theme)
                text = self._call_yandex_gpt(prompt)

                # –ü–∞—Ä—Å–∏–º –æ—Ç–≤–µ—Ç: –∑–∞–≥–æ–ª–æ–≤–æ–∫ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ), —Ç–µ–∫—Å—Ç, CTA
                title, body, cta = self._parse_response(text)

                post = {
                    'type': post_type,
                    'title': title,
                    'body': body,
                    'cta': cta,
                    'publish_date': start_date + timedelta(days=len(posts)),
                    'image_prompt': self.build_image_prompt({'type': post_type})  # ‚Üê –¥–æ–±–∞–≤–∏—Ç—å
                }
                posts.append(post)

        return posts

    def _build_prompt(self, post_type, theme=None):
        """–§–æ—Ä–º–∏—Ä—É–µ—Ç –ø—Ä–æ–º–ø—Ç –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–∏–ø–∞ –ø–æ—Å—Ç–∞"""
        season = self._get_season_context()
        theme_note = f"\n–£—á–∏—Ç—ã–≤–∞–π —Ç–µ–º—É –Ω–µ–¥–µ–ª–∏: {theme}" if theme else ""

        prompts = {
            '—ç–∫—Å–ø–µ—Ä—Ç–∏–∑–∞': f"""
–°–æ–∑–¥–∞–π —ç–∫—Å–ø–µ—Ä—Ç–Ω—ã–π –ø–æ—Å—Ç –¥–ª—è Telegram-–∫–∞–Ω–∞–ª–∞ –ø–æ –ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∞–º –∫–≤–∞—Ä—Ç–∏—Ä –≤ –ú–æ—Å–∫–≤–µ.

–ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–µ–∑–æ–Ω–∞: {season}{theme_note}

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- –†–∞–∑–±–æ—Ä –æ–¥–Ω–æ–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –Ω–æ—Ä–º—ã, –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –∏–ª–∏ —Ç–∏–ø–∏—á–Ω–æ–π –æ—à–∏–±–∫–∏
- 150‚Äì300 —Å–ª–æ–≤, —ç–∫—Å–ø–µ—Ä—Ç–Ω–æ, –±–µ–∑ –≤–æ–¥—ã
- –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø—Ä–∏–º–µ—Ä –∏–ª–∏ –∫–µ–π—Å –∏–∑ –ø—Ä–∞–∫—Ç–∏–∫–∏
- –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π CTA –∫ –±–æ—Ç—É @Parkhovenko_i_kompaniya_bot

–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞:
[–ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏–ª–∏ –≤–æ–ø—Ä–æ—Å] (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

[–û—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç –ø–æ—Å—Ç–∞]

üëâ [CTA —Å –ø—Ä–∏–∑—ã–≤–æ–º –∫ –¥–µ–π—Å—Ç–≤–∏—é]
""",
            '–∂–∏–≤–æ–π': f"""
–°–æ–∑–¥–∞–π ¬´–∂–∏–≤–æ–π¬ª –ø–æ—Å—Ç –¥–ª—è Telegram-–∫–∞–Ω–∞–ª–∞ –ø–æ –ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∞–º.

–ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–µ–∑–æ–Ω–∞: {season}{theme_note}

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- –ü—Ä–∏–≤—è–∑–∫–∞ –∫ —Ç–µ–∫—É—â–∏–º —Å–æ–±—ã—Ç–∏—è–º (–ø–æ–≥–æ–¥–∞, –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –ñ–ö–•, —Å–µ–∑–æ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∂–∏–ª—å—Ü–æ–≤)
- 150‚Äì250 —Å–ª–æ–≤, –ø–æ-—á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏, —Å –ª–∏—á–Ω–æ–π –Ω–æ—Ç–∫–æ–π
- –ú—è–≥–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Ç–µ–º–µ –ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–æ–∫ –∏ —Ä–∏—Å–∫–æ–≤
- CTA –∫ –±–æ—Ç—É @Parkhovenko_i_kompaniya_bot

–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞:
[–°–µ–∑–æ–Ω–Ω—ã–π –∑–∞—Ü–µ–ø –∏–ª–∏ –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ]

[–°–≤—è–∑–∫–∞ —Å —Ç–µ–º–æ–π –ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–æ–∫]

üëâ [CTA]
""",
            '–Ω–æ–≤–æ—Å—Ç—å': f"""
–°–æ–∑–¥–∞–π –Ω–æ–≤–æ—Å—Ç–Ω–æ–π –ø–æ—Å—Ç –¥–ª—è Telegram-–∫–∞–Ω–∞–ª–∞ –ø–æ –ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∞–º.

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- –û–±—ä—è–≤–ª–µ–Ω–∏–µ –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –Ω–æ—Ä–º, –Ω–æ–≤–æ–º —Ä–∞–∑—ä—è—Å–Ω–µ–Ω–∏–∏ –∏–ª–∏ –≤–∞–∂–Ω–æ–º –∫–µ–π—Å–µ
- 120‚Äì200 —Å–ª–æ–≤, –∫—Ä–∞—Ç–∫–æ –∏ —á—ë—Ç–∫–æ
- –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å –∏ —á–µ–º —ç—Ç–æ —á—Ä–µ–≤–∞—Ç–æ –¥–ª—è –∂–∏–ª—å—Ü–æ–≤
- CTA –∫ –±–æ—Ç—É @Parkhovenko_i_kompaniya_bot –¥–ª—è —Ä–∞–∑–±–æ—Ä–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏{theme_note}

–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞:
[–ù–æ–≤–æ—Å—Ç—å –ø—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏]

[–ß—Ç–æ —ç—Ç–æ –∑–Ω–∞—á–∏—Ç –¥–ª—è –∂–∏–ª—å—Ü–æ–≤]

üëâ [CTA]
""",
            '–ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ': f"""
–ù–∞–ø–∏—à–∏ –∫–æ—Ä–æ—Ç–∫–æ–µ –∏—Å–∫—Ä–µ–Ω–Ω–µ–µ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ —Å –¥–Ω—ë–º —Ä–æ–∂–¥–µ–Ω–∏—è.

–ö–æ–≥–æ –ø–æ–∑–¥—Ä–∞–≤–ª—è–µ–º: {theme_note or '–¥—Ä—É–≥'}

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- 60-100 —Å–ª–æ–≤
- –¢—ë–ø–ª—ã–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è —Å—á–∞—Å—Ç—å—è, –∑–¥–æ—Ä–æ–≤—å—è, —Ä–∞–¥–æ—Å—Ç–∏
- –ü–æ–∂–µ–ª–∞–Ω–∏–µ —É—é—Ç–∞ –∏ —Ç–µ–ø–ª–∞ –≤ –¥–æ–º–µ
- –ü—Ä–æ—Å—Ç–æ–π –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π —è–∑—ã–∫
- –ë–ï–ó —É–ø–æ–º–∏–Ω–∞–Ω–∏—è —Ä–∞–±–æ—Ç—ã, —É—Å–ª—É–≥, –±–∏–∑–Ω–µ—Å–∞

–§–æ—Ä–º–∞—Ç:
üéÇ [–ò–º—è]

[–ü–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ —Å –ø–æ–∂–µ–ª–∞–Ω–∏—è–º–∏]
"""
        }

        return prompts.get(post_type, prompts['—ç–∫—Å–ø–µ—Ä—Ç–∏–∑–∞'])

    def _get_season_context(self):
        """–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å–µ–∑–æ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç"""
        month = datetime.now().month

        contexts = {
            (12, 1, 2): "–ó–∏–º–∞: —Å–Ω–µ–≥ –∑–∞–≤–∞–ª–∏–ª –ú–æ—Å–∫–≤—É, –ø—Ä–æ–º–µ—Ä–∑–∞—é—â–∏–µ –æ–∫–Ω–∞, –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –æ—Ç–æ–ø–ª–µ–Ω–∏—è, —Å–æ—Å—É–ª—å–∫–∏ –Ω–∞ –∫–æ–∑—ã—Ä—å–∫–∞—Ö, —É—Ç–µ–ø–ª–µ–Ω–∏–µ",
            (3, 4, 5): "–í–µ—Å–Ω–∞: –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –≥–æ—Ä—è—á–µ–π –≤–æ–¥—ã, –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —Ä–µ–º–æ–Ω—Ç–Ω–æ–º—É —Å–µ–∑–æ–Ω—É, –ø–æ—Ä–∞ –∑–∞–¥—É–º–∞—Ç—å—Å—è –æ –ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∫–µ",
            (6, 7, 8): "–õ–µ—Ç–æ: –ø–∏–∫ —Ä–µ–º–æ–Ω—Ç–Ω–æ–≥–æ —Å–µ–∑–æ–Ω–∞, –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏",
            (9, 10, 11): "–û—Å–µ–Ω—å: –≤–∫–ª—é—á–µ–Ω–∏–µ –æ—Ç–æ–ø–ª–µ–Ω–∏—è, –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–µ–º–æ–Ω—Ç–æ–≤ –ø–µ—Ä–µ–¥ –∑–∏–º–æ–π"
        }

        for months, context in contexts.items():
            if month in months:
                return context
        return contexts[(12, 1, 2)]

    def _call_yandex_gpt(self, user_prompt, mode="default"):
        """–í—ã–∑–æ–≤ YandexGPT API"""

        if mode == "greeting":
            system_prompt = """
–¢—ã –ø–∏—à–µ—à—å –∫–æ—Ä–æ—Ç–∫–∏–µ –ª–∏—á–Ω—ã–µ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è.

–¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –ø–∏—Å–∞—Ç—å —Ç—ë–ø–ª—ã–µ —á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏–µ —Ç–µ–∫—Å—Ç—ã –±–µ–∑ –ø—Ä–æ–¥–∞–∂ –∏ –±–µ–∑ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è —É—Å–ª—É–≥, –∫–æ–º–ø–∞–Ω–∏–π, –±–æ—Ç–æ–≤, —Ä–µ–∫–ª–∞–º—ã, –∞–∫—Ü–∏–π –∏ —Å–∫–∏–¥–æ–∫.
–°—Ç—Ä–æ–≥–æ –∑–∞–ø—Ä–µ—â–µ–Ω–æ —É–ø–æ–º–∏–Ω–∞—Ç—å –ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∫—É, —Ä–µ–º–æ–Ω—Ç, —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ —É—Å–ª—É–≥–∏, –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏, –∫—Ä–µ–¥–∏—Ç—ã, –¥–æ–ª–≥–∏, –±–∏–∑–Ω–µ—Å, –∫–æ–º–∞–Ω–¥—É —ç–∫—Å–ø–µ—Ä—Ç–æ–≤, Telegram-–±–æ—Ç–æ–≤ –∏ –ª—é–±—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è ¬´–æ–±—Ä–∞—Ç–∏—Ç—å—Å—è¬ª, ¬´–∑–∞–∫–∞–∑–∞—Ç—å¬ª, ¬´–ø–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é¬ª.

–ü–∏—à–∏ –ø—Ä–æ—Å—Ç—ã–º –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–º —è–∑—ã–∫–æ–º, –∫–∞–∫ —á–µ–ª–æ–≤–µ–∫ —á–µ–ª–æ–≤–µ–∫—É.
–ù–µ –¥–æ–±–∞–≤–ª—è–π —Å—Å—ã–ª–∫–∏, —Ö—ç—à—Ç–µ–≥–∏, GIF, —ç–º–æ–¥–∑–∏ –∫—Ä–æ–º–µ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –≤ —Ñ–æ—Ä–º–∞—Ç–µ.
"""
        else:
            system_prompt = f"""
–¢—ã ‚Äî –∫–æ–Ω—Ç–µ–Ω—Ç-–º–µ–Ω–µ–¥–∂–µ—Ä Telegram-–∫–∞–Ω–∞–ª–∞ –ø–æ –ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∞–º –∫–≤–∞—Ä—Ç–∏—Ä –≤ –ú–æ—Å–∫–≤–µ.

–ó–∞–¥–∞—á–∞: –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Å—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–≥—Ä–µ–≤–∞—é—Ç –∫ –∑–∞—è–≤–∫–µ –≤ –±–æ—Ç–∞ @Parkhovenko_i_kompaniya_bot.

–°—Ç–∏–ª—å: —ç–∫—Å–ø–µ—Ä—Ç–Ω–æ, –ø–æ-–¥–µ–ª–æ–≤–æ–º—É, –±–µ–∑ –≤–æ–¥—ã, —Å –ø–æ–Ω—è—Ç–Ω—ã–º–∏ –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∏ —á—ë—Ç–∫–∏–º–∏ CTA.

–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π:
{self.brief_content[:3000]}

–ö–∞–∂–¥—ã–π –ø–æ—Å—Ç –¥–æ–ª–∂–µ–Ω –≤–µ—Å—Ç–∏ —á–∏—Ç–∞—Ç–µ–ª—è –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —à–∞–≥—É: –ø–æ–¥–ø–∏—Å–∫–∞, –±–æ—Ç, –∑–∞—è–≤–∫–∞.
"""

        headers = {
            "Content-Type": "application/json",
            "Authorization": f"Api-Key {self.api_key}",
            "x-folder-id": self.folder_id
        }

        payload = {
            "modelUri": f"gpt://{self.folder_id}/yandexgpt/latest",
            "completionOptions": {
                "stream": False,
                "temperature": 0.7,
                "maxTokens": 2000
            },
            "messages": [
                {"role": "system", "text": system_prompt},
                {"role": "user", "text": user_prompt}
            ]
        }

        response = requests.post(self.endpoint, headers=headers, json=payload, timeout=30)
        response.raise_for_status()

        result = response.json()
        return result['result']['alternatives'][0]['message']['text']

    def _parse_response(self, text):
        """–ü–∞—Ä—Å–∏—Ç –æ—Ç–≤–µ—Ç LLM –Ω–∞ title, body, cta"""
        lines = text.strip().split('\n')

        # –ò—â–µ–º CTA (—Å—Ç—Ä–æ–∫–∏ —Å üëâ –∏–ª–∏ "CTA:")
        cta_line = None
        for i, line in enumerate(lines):
            if 'üëâ' in line or 'CTA:' in line.upper():
                cta_line = i
                break

        if cta_line:
            cta = '\n'.join(lines[cta_line:]).strip()
            body_lines = lines[:cta_line]
        else:
            cta = ""
            body_lines = lines

        # –ü–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–æ–º, –µ—Å–ª–∏ –æ–Ω–∞ –∫–æ—Ä–æ—Ç–∫–∞—è
        title = ""
        if body_lines and len(body_lines[0]) < 100:
            title = body_lines[0].strip('#').strip()
            body_lines = body_lines[1:]

        body = '\n'.join(body_lines).strip()

        return title, body, cta

    def _sanitize_greeting(self, text: str) -> str:
        """–£–±–∏—Ä–∞–µ—Ç —Å–ª–∏—à–∫–æ–º –ø—Ä–æ–¥–∞—é—â–∏–µ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è (—Å—Ç—Ä–∞—Ö–æ–≤–∫–∞)"""
        banned = [
            "—Ä–µ–º–æ–Ω—Ç", "–ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤", "—É—Å–ª—É–≥", "–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü", "–±–æ—Ç",
            "—Ç–µ–ª–µ–≥—Ä–∞–º", "–∫–æ–º–∞–Ω–¥–∞ —ç–∫—Å–ø–µ—Ä—Ç–æ–≤", "—Å–∫–∏–¥–∫", "–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ",
            "–∑–∞–∫–∞–∂–∏—Ç–µ", "–æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å", "—é—Ä–∏–¥–∏—á–µ—Å–∫", "–∫—Ä–µ–¥–∏—Ç", "–¥–æ–ª–≥"
        ]
        lower = text.lower()
        if any(word in lower for word in banned):
            # –§–æ–ª–±—ç–∫ ‚Äî –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ–µ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ –±–µ–∑ –ø—Ä–æ–¥–∞–∂
            return (
                "–ü—É—Å—Ç—å —ç—Ç–æ—Ç –¥–µ–Ω—å –±—É–¥–µ—Ç –¥–ª—è –≤–∞—Å —Ç—ë–ø–ª—ã–º –∏ —Ä–∞–¥–æ—Å—Ç–Ω—ã–º. "
                "–ñ–µ–ª–∞–µ–º –∑–¥–æ—Ä–æ–≤—å—è, –¥—É—à–µ–≤–Ω–æ–≥–æ –∫–æ–º—Ñ–æ—Ä—Ç–∞, —É—é—Ç–∞ –¥–æ–º–∞ –∏ –ª—é–¥–µ–π —Ä—è–¥–æ–º, "
                "—Å –∫–æ—Ç–æ—Ä—ã–º–∏ —Ö–æ—á–µ—Ç—Å—è –¥–µ–ª–∏—Ç—å—Å—è —Ö–æ—Ä–æ—à–∏–º–∏ –º–æ–º–µ–Ω—Ç–∞–º–∏."
            )
        return text

    def generate_greeting_post(self, person_name, date, occasion='–¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è'):
        """
        –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ø–æ–∑–¥—Ä–∞–≤–∏—Ç–µ–ª—å–Ω—ã–π –ø–æ—Å—Ç

        Args:
            person_name: –ò–º—è —á–µ–ª–æ–≤–µ–∫–∞ (–º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º)
            date: –î–∞—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ DD.MM –∏–ª–∏ DD.MM.YYYY
            occasion: –ü–æ–≤–æ–¥ –¥–ª—è –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è ('–¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è', '–ù–æ–≤—ã–π –≥–æ–¥', etc.)

        Returns:
            dict: {'title': str, 'body': str, 'cta': str, 'type': '–ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ'}
        """
        display_name = person_name if person_name else "–Ω–∞—à –ø–æ–¥–ø–∏—Å—á–∏–∫"

        prompt = f"""
–°–æ–∑–¥–∞–π –∫–æ—Ä–æ—Ç–∫–æ–µ –∏—Å–∫—Ä–µ–Ω–Ω–µ–µ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è –ª–∏—á–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Telegram.

–ü–æ–≤–æ–¥: {occasion}
–ò–º—è: {display_name}
–î–∞—Ç–∞: {date}

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- –¢—ë–ø–ª–æ–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–µ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ (60‚Äì100 —Å–ª–æ–≤)
- –ü–æ–∂–µ–ª–∞–Ω–∏—è –∑–¥–æ—Ä–æ–≤—å—è, —Ä–∞–¥–æ—Å—Ç–∏, –¥—É—à–µ–≤–Ω–æ–≥–æ –∫–æ–º—Ñ–æ—Ä—Ç–∞, —É—é—Ç–∞ –¥–æ–º–∞
- –ü—Ä–æ—Å—Ç–æ–π –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π —è–∑—ã–∫, –±–µ–∑ –≤—ã—Å–æ–∫–æ–ø–∞—Ä–Ω–æ–≥–æ –∫–∞–Ω—Ü–µ–ª—è—Ä–∏—Ç–∞
- –°—Ç—Ä–æ–≥–æ –∑–∞–ø—Ä–µ—â–µ–Ω–æ —É–ø–æ–º–∏–Ω–∞—Ç—å —É—Å–ª—É–≥–∏, —Ä–µ–º–æ–Ω—Ç, –ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∫—É, –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏, –±–æ—Ç–æ–≤, –∫–æ–º–ø–∞–Ω–∏–∏, –∞–∫—Ü–∏–∏, —Å–∫–∏–¥–∫–∏ –∏ –ª—é–±—ã–µ –ø—Ä–æ–¥–∞–∂–∏.
- –ù–µ –¥–æ–±–∞–≤–ª—è–π CTA, —Å—Å—ã–ª–∫–∏, —Ö—ç—à—Ç–µ–≥–∏, GIF –∏ –ø—Ä–∏–∑—ã–≤—ã —á—Ç–æ-—Ç–æ –∑–∞–∫–∞–∑–∞—Ç—å –∏–ª–∏ —É–∑–Ω–∞—Ç—å.

–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞:
üéÇ {display_name}

[–ü–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ —Å –ø–æ–∂–µ–ª–∞–Ω–∏—è–º–∏]
"""

        text = self._call_yandex_gpt(prompt, mode="greeting")
        text = self._sanitize_greeting(text)

        # –î–ª—è –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è title –º–æ–∂–Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å, –≤—Å—ë –≤ body
        title = ""
        body = text.strip()
        cta = ""  # –Ω–∏–∫–∞–∫–∏—Ö CTA –≤ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–∏

        return {
            'type': '–ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ',
            'title': title,
            'body': body,
            'cta': cta
        }

    def generate_birthday_congrats_template(self, person_name: str | None, date: str):
        """
        –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ —Å –¥–Ω–µ–º —Ä–æ–∂–¥–µ–Ω–∏—è –∏–∑ —à–∞–±–ª–æ–Ω–æ–≤ (–±–µ–∑ –ò–ò)

        Args:
            person_name: –ò–º—è —á–µ–ª–æ–≤–µ–∫–∞ –∏–ª–∏ None
            date: –î–∞—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ DD.MM –∏–ª–∏ DD.MM.YYYY

        Returns:
            dict: {'title': str, 'body': str, 'cta': str, 'type': '–ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ'}
        """
        import random

        # –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π —à–∞–±–ª–æ–Ω
        congrats_text = random.choice(self.birthday_templates)

        # –§–æ—Ä–º–∏—Ä—É–µ–º –∏–º—è –¥–ª—è –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è
        display_name = person_name if person_name else "–Ω–∞—à –ø–æ–¥–ø–∏—Å—á–∏–∫"

        # –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–ª–æ —Å–æ–æ–±—â–µ–Ω–∏—è
        body = f"üéÇ {display_name}\n\n{congrats_text}"

        return {
            'type': '–ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ',
            'title': '',
            'body': body,
            'cta': ''
        }

    def generate_welcome_post(self, person_name: str | None = None):
        """
        –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ-–≤–∏–∑–∏—Ç–∫—É –¥–ª—è –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞.

        Args:
            person_name: –ò–º—è —á–µ–ª–æ–≤–µ–∫–∞ –∏–ª–∏ None

        Returns:
            dict: {'title': str, 'body': str, 'cta': str, 'type': '–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ'}
        """
        display_name = person_name if person_name else "–Ω–æ–≤—ã–π –ø–æ–¥–ø–∏—Å—á–∏–∫"

        prompt = f"""
–°–æ–∑–¥–∞–π –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è Telegram-–∫–∞–Ω–∞–ª–∞ –ø–æ –ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∞–º.

–ê–¥—Ä–µ—Å–∞—Ç: {display_name}

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- 80‚Äì120 —Å–ª–æ–≤
- –ö—Ä–∞—Ç–∫–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å –∫–∞–Ω–∞–ª –∏ –ø–æ–ª—å–∑—É: –ø–æ–º–æ—â—å —Å –≤–æ–ø—Ä–æ—Å–∞–º–∏ –ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏, —Ä–∏—Å–∫–∞–º–∏, —É–∑–∞–∫–æ–Ω–∏–≤–∞–Ω–∏–µ–º
- 1‚Äì2 –ø—Ä–æ—Å—Ç—ã—Ö –ø—Ä–∏–º–µ—Ä–∞ —Å–∏—Ç—É–∞—Ü–∏–π, –∫–æ–≥–¥–∞ –∫ –Ω–∞–º –º–æ–∂–Ω–æ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è (–ø–µ—Ä–µ–Ω–æ—Å —Å—Ç–µ–Ω, –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –∫—É—Ö–Ω–∏ –∏ –∫–æ–º–Ω–∞—Ç—ã, –ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∞ —Å –º–æ–∫—Ä—ã–º–∏ –∑–æ–Ω–∞–º–∏)
- –û–¥–∏–Ω –∞–∫–∫—É—Ä–∞—Ç–Ω—ã–π CTA –∫ –±–æ—Ç—É @Parkhovenko_i_kompaniya_bot
- –°–ø–æ–∫–æ–π–Ω—ã–π, –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π —Ç–æ–Ω

–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞:
üëã {display_name}

[–¢–µ–∫—Å—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è 2‚Äì3 –∞–±–∑–∞—Ü–∞ —Å CTA –≤ –∫–æ–Ω—Ü–µ]
"""

        text = self._call_yandex_gpt(prompt, mode="default")  # –æ–±—ã—á–Ω—ã–π –ø—Ä–æ–¥–∞—é—â–∏–π —Ä–µ–∂–∏–º
        title, body, cta = self._parse_response(text)

        return {
            'type': '–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ',
            'title': title,
            'body': body,
            'cta': cta
        }
