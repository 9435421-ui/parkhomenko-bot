# ПОЛНЫЙ ОТЧЕТ ПО ПРОЕКТУ «ТЕРИОН»

## 1. Статус запуска процессов
Оба бота запущены в фоновом режиме с автоматическим перезапуском:
- **Основной бот (@terion_bot):** Работает (процесс `main.py`). Логи: `main_bot.log`, ошибки: `main_bot_error.log`.
- **Контент-бот (@domGrad_bot):** Работает (процесс `content_bot_mvp/main.py`). Логи: `bot.log`, ошибки: `bot_error_log.txt`.

---

## 2. Структура проекта

```text
.
├── main.py                  # Входная точка основного бота (aiogram 3.x)
├── config.py                # Централизованная конфигурация (загрузка из .env)
├── parkhomenko_bot.db       # Единая база данных (SQLite)
├── .env                     # Переменные окружения (токены, API-ключи)
├── run_main_bot.sh          # Скрипт запуска основного бота
├── run_bot.sh               # Скрипт запуска контент-бота
│
├── content_bot_mvp/         # Модуль контент-бота (Telebot)
│   ├── main.py              # Код контент-бота
│   ├── posts.json           # Очередь публикаций
│   └── .env                 # Конфиг контент-бота
│
├── handlers/                # Обработчики логики основного бота
│   ├── start.py             # Команда /start, приветствие, согласие
│   ├── quiz.py              # Квалификация (квиз из 10 шагов)
│   ├── dialog.py            # ИИ-консультант (RAG)
│   └── invest.py            # Инвест-калькулятор
│
├── database/                # Работа с БД
│   ├── db.py                # Асинхронные методы (upsert_unified_lead и др.)
│   └── models.py            # Схемы данных
│
├── utils/                   # Вспомогательные сервисы
│   ├── yandex_gpt.py        # Интеграция с YandexGPT
│   ├── knowledge_base.py    # Поиск по базе знаний (RAG)
│   └── voice_handler.py     # Транскрибация голосовых сообщений
│
├── services/                # Внешние интеграции
│   ├── vk_service.py        # Публикация в VK
│   └── lead_service.py      # Обработка лидов
│
├── knowledge_base/          # База знаний (Markdown-файлы для RAG)
│   ├── 04_Москва/           # Специфика Москвы
│   ├── 01_Федеральные_законы/
│   └── ...                  # Другие категории (всего 15+)
│
├── keyboards/               # Клавиатуры (UI)
│   └── main_menu.py         # Главное меню и инлайновые кнопки
│
├── migrations/              # Скрипты миграции БД
└── docs/                    # Документация и копия базы знаний
```

---

## 3. Ключевые изменения
1. **Унификация квиза:** В обоих ботах теперь используется идентичный флоу из 10 шагов (Роль -> Город -> Тип объекта -> Этаж -> Площадь -> Статус -> Сложность -> Цель -> БТИ -> Срочность).
2. **Исправление импортов:** Исправлены ошибки относительного импорта в `handlers/start.py` и `handlers/quiz.py`.
3. **Безопасность данных:** Все лиды сохраняются в таблицу `unified_leads` с пометкой `source_bot`.
4. **Ребрендинг:** Все упоминания «ТОРИОН» заменены на «ТЕРИОН» в пользовательских интерфейсах.
5. **Интеграция с VK:** Подготовлен модуль для дублирования контента в сообщество VK (токен и ID группы настроены).
6. **AI Консультант:** Настроен RAG с лимитом в 400 символов и запретом на указание цен.
7. **Release 2.0 (Контент + Лояльность):**
   - Установлен жесткий фильтр на темы Креативщика (только недвижимость, перепланировки, профильные новости, интересные факты).
   - Внедрена категория «Интересные факты» (архитектура, история, инженерия).
   - Запущен `LoyaltyService` для автоматических поздравлений с Днем Рождения и праздниками РФ.
   - Добавлена функция настройки профиля (дата рождения) для подписчиков.

---

## 4. Контакты и ссылки
- **Основной бот:** [t.me/terion_bot](https://t.me/terion_bot)
- **Контент-бот:** [t.me/domGrad_bot](https://t.me/domGrad_bot)
- **Консультация:** [t.me/terion_expert](https://t.me/terion_expert)
- **Mini App:** [ternion.ru/mini_app/](https://ternion.ru/mini_app/)
