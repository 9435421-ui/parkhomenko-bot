АНАЛИЗ CONTENT AGENT В bot_unified.py
====================================

1. НАЛИЧИЕ ФАЙЛОВ:
   ✅ content_agent.py - ПРИСУТСТВУЕТ
   ✅ auto_poster.py - ПРИСУТСТВУЕТ

2. КЛАССЫ И МЕТОДЫ В content_agent.py:
   ОСНОВНОЙ КЛАСС: ContentAgent

   КЛЮЧЕВЫЕ МЕТОДЫ:
   - __init__() - инициализация с загрузкой brief_content и шаблонов поздравлений
   - generate_posts(count, post_types, theme) - генерация постов на неделю
   - _call_yandex_gpt() - вызов YandexGPT API
   - _parse_response() - парсинг ответа LLM на title/body/cta
   - generate_birthday_congrats_template() - генерация поздравлений из шаблонов
   - generate_greeting_post() - генерация персонального поздравления через ИИ
   - generate_welcome_post() - генерация приветственного сообщения
   - build_image_prompt() - генерация промпта для изображений

   ОСОБЕННОСТИ:
   - Использует YandexGPT для генерации контента
   - Загружает базу знаний из BRIEF_pereplanirovki.md
   - Поддерживает сезонный контекст
   - Имеет защиту от слишком продающих поздравлений (_sanitize_greeting)

3. ФУНКЦИЯ run_auto_poster В auto_poster.py:
   ЧТО ДЕЛАЕТ:
   - Запускает автоматическую публикацию контента в фоне
   - Каждые 10 минут проверяет готовые посты (check_and_publish)
   - Получает посты через db.get_posts_to_publish()
   - Публикует в канал CONTENT_CHANNEL_ID
   - Форматирует посты для Telegram (HTML экранирование)
   - Отмечает опубликованные посты как published
   - Логирует публикации в группу LEADS_GROUP_CHAT_ID

4. КОМАНДЫ В bot_unified.py:

   /generate_content:
   - ДОСТУП: Только администратор (проверка message.from_user.id != ADMIN_ID)
   - ФУНКЦИЯ: Генерация контент-плана на неделю
   - ЧТО ДЕЛАЕТ:
     * Парсит тему из команды (/generate_content Тема: новый год...)
     * Создает экземпляр ContentAgent()
     * Генерирует 7 постов через agent.generate_posts(7, theme=theme)
     * Сохраняет в БД через db.save_post()
     * Отправляет черновики в соответствующие топики группы
     * Логирует в THREAD_ID_LOGS
   - ОТВЕТ: "✅ Сгенерировано X постов! Черновики отправлены в группу."

   /show_plan:
   - ДОСТУП: Только администратор
   - ФУНКЦИЯ: Показ существующего контент-плана
   - ЧТО ДЕЛАЕТ:
     * Получает черновики через db.get_draft_posts()
     * Отправляет все черновики в соответствующие топики группы
     * Логирует в THREAD_ID_LOGS
   - ОТВЕТ: "✅ Черновики (X шт.) отправлены в группу."

   /generate_greetings:
   - ДОСТУП: Только администратор
   - ФУНКЦИЯ: Генерация поздравлений с днем рождения
   - ЧТО ДЕЛАЕТ:
     * Получает предстоящие дни рождения через db.get_upcoming_birthdays(7)
     * Для каждого человека генерирует поздравление через ContentAgent
     * Сохраняет как черновики типа 'поздравление'
     * Отправляет в топик THREAD_ID_DRAFTS
   - ОТВЕТ: "✅ Сгенерировано X поздравлений! Черновики отправлены..."

5. ИМПОРТЫ В НАЧАЛЕ bot_unified.py:
   ✅ from content_agent import ContentAgent
   ✅ from auto_poster import run_auto_poster

   ОБА ИМПОРТА ПРИСУТСТВУЮТ в разделе "# --------- CONTENT AGENT ---------"

6. ДОПОЛНИТЕЛЬНАЯ ИНФОРМАЦИЯ:
   - AutoPoster запускается в отдельном потоке при старте бота
   - Content Agent интегрирован с базой данных для хранения контент-плана
   - Поддерживается модерация постов (утверждение/удаление через callback)
   - Система логов для отслеживания генерации и публикации контента
   - Разделение по топикам: THREAD_ID_DRAFTS, THREAD_ID_SEASONAL, THREAD_ID_LOGS
