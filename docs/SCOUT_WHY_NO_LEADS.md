# Почему шпион может не находить лидов

45 млн человек в Москве и области — вопросы по перепланировке точно есть. Если за несколько часов нет ни одного контакта, дело обычно не в людях, а в том, **где** и **как** мы ищем.

## 1. Telegram: мы смотрим каналы, а не чаты

**Что делает шпион сейчас:** читает последние посты в **каналах** (Новостройки Москвы, Первичка, Недвижимость Москва и т.п.).

**В чём подвох:** в канале посты пишет только владелец/админ. Подписчики не пишут. То есть мы смотрим контент застройщиков и агентств, а не вопросы обычных людей.

**Где люди реально спрашивают:** в **чатах и группах** — чаты ЖК, ТСЖ, обсуждения ремонта, «посоветуйте мастера», «как узаконить». Туда шпион по умолчанию не заходит (у нас в списке в основном каналы).

**Что сделать:**
- Добавить в мониторинг **Telegram-группы/чаты**, где пишут жители: чаты конкретных ЖК, чаты по ремонту/перепланировке (ищем по ссылкам или через ручной список).
- В `.env` задать свои каналы/чаты: `SCOUT_TG_CHANNEL_1_ID`, `SCOUT_TG_CHANNEL_1_NAME` и т.д. Включать туда в первую очередь **чаты**, а не только каналы.

## 2. Мало сообщений на источник

**Было:** 15 последних постов на канал. За пару часов в активном канале выходит десятки постов — мы их уже не видим.

**Сделано:** лимит увеличен до 50 (настраивается через `SCOUT_TG_MESSAGES_LIMIT` в `.env`). В отчёте шпиона видно, сколько сообщений реально просмотрено.

**Рекомендация:** смотреть отчёт `/spy_report`: если «просмотрено 600, лидов 0» — мы что-то читаем, но в этих постах просто нет ключевых слов. Если «просмотрено 0» по части каналов — нет доступа или ошибка (сессия, права).

## 3. VK: стена vs комментарии

**Что делали:** только посты со **стены** группы (`wall.get`). На стене чаще постит админ, а не жители.

**Где люди пишут в VK:** в **комментариях** к постам: «посоветуйте», «как узаконить», «кто делал перепланировку».

**Сделано:** парсер смотрит и комментарии к постам (до 10 постов на группу, до 30 комментариев на пост). Настраивается: `SCOUT_VK_POSTS_FOR_COMMENTS`, `SCOUT_VK_COMMENTS_PER_POST`.

**Рекомендация:** добавить в список VK-групп те, где активно общаются в комментариях (ремонт, недвижимость, районные группы). ID групп задаются в `.env` или в коде.

## 4. Гео-чаты (ЖК) не запущены

В коде есть **гео-шпион** — мониторинг чатов жилых комплексов (Перекрёсток, Самолёт, ПИК и т.д.). Там как раз пишут жители.

**Важно:** в `main.py` по расписанию запускается только **Lead Hunter** (ScoutParser: каналы TG + стена/комменты VK). Отдельный цикл для гео-чатов (`run_geo_spy` / `scan_geo_chats`) в расписание не добавлен, поэтому эти чаты по умолчанию не сканируются.

**Что сделать:** если нужен мониторинг чатов ЖК — добавить в `main.py` задачу по расписанию для гео-шпиона и задать в конфиге список чатов (GEO_CHAT_1_ID и т.д.).

## 5. Сессия Telegram (Anton)

Шпион по Telegram использует сессию **anton_parser** (Telethon). Если сессия не создана или протухла, в логах будет что-то вроде «Антон не авторизован в Telegram» и по TG лидов не будет вообще.

**Что сделать:** один раз на сервере выполнить `python session_manager.py`, войти по коду из Telegram. После этого парсер сможет читать каналы/чаты.

## 6. Ключевые слова

Список триггеров и ключевых слов задан в `scout_parser.py` (перепланировка, согласование, узаконить, ремонт квартиры и т.д.). Если люди формулируют иначе («хочу снести стену», «нужен проект»), такие сообщения тоже можно добавить в `LEAD_TRIGGERS` или `KEYWORDS` в коде или через админку (ключевые слова).

---

## Краткий чек-лист

| Проверка | Действие |
|----------|----------|
| В отчёте «просмотрено 0» по TG | Проверить сессию: `python session_manager.py`, авторизация. |
| Просмотрено много, лидов 0 | Добавить **чаты** (не только каналы) и/или группы VK с живыми обсуждениями; при необходимости расширить ключевые слова. |
| Нужны чаты ЖК | Включить гео-шпион в расписании и настроить GEO_CHAT_* в конфиге. |
| VK пусто | Проверить VK_TOKEN и что группа бота вступила в те группы, которые парсим; смотреть отчёт — возможно, ошибка доступа. |

Итог: «никто не спрашивает» почти всегда значит «мы смотрим не туда или слишком мало». Сместить фокус на чаты и обсуждения, где пишут люди, и убедиться, что по ним реально идёт скан (отчёт и логи).
