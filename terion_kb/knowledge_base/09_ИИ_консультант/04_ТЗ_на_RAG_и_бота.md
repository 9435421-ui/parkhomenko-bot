# ТЗ на интеграцию базы знаний с Telegram‑ботом (RAG)

## 1. Исходные данные

- Бот: Telegram‑бот на Python с интеграцией Yandex GPT.  
- Сервер: свой VPS, код уже задеплоен.  
- База знаний: Markdown‑файлы в папке `C:\бот_по_перепланировкам\knowledge_base\` (или соответствующий путь на сервере).

## 2. Требования к поиску (RAG)

- Индексировать все `.md` файлы в подпапках `knowledge_base`.  
- При запросе пользователя:  
  1. Формировать поисковый запрос (по смыслу).  
  2. Находить 3–5 релевантных фрагментов (контекстов) из базы.  
  3. Подставлять их в промпт для Yandex GPT перед генерацией ответа.  
- Ограничение по длине контекста: не превышать лимиты Yandex GPT (оставлять запас под ответ).

## 3. Приоритеты источников

- Высокий приоритет:  
  - нормативка, процедуры, технические разделы;  
  - FAQ и сценарии (`09_ИИ_консультант`).  
- Низкий приоритет:  
  - кейсы и длинные судебные решения (использовать только для уточнений и примеров).

## 4. Интеграция с существующим кодом

- Создать модуль, например: `kb_rag.py`, который будет:  
  - при старте бота загружать и индексировать `.md` файлы;  
  - предоставлять функцию `get_context(user_query) -> str`.  
- В основном коде диалога:  
  - перед отправкой запроса в Yandex GPT вызывать `get_context(user_query)`;  
  - добавлять полученный контекст в `system` или `assistant` часть промпта.

## 5. Логирование и отладка

- Логировать:  
  - исходный запрос пользователя;  
  - какие файлы и фрагменты были выбраны;  
  - финальный ответ бота.  
- Предусмотреть возможность быстро отключить RAG (флаг в конфиге) для тестов.

## 6. Дальнейшее развитие

- Добавить тегирование файлов (метаданные: регион, тип объекта, тип работ).  
- Реализовать перезагрузку индекса без перезапуска бота (команда администратора).

